<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI åœ–ç‰‡å»èƒŒ (é€²åº¦æ¢ç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.5.5/dist/imgly-background-removal.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
            overscroll-behavior-y: none;
        }

        .container {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 800px;
            text-align: center;
        }

        h1 { margin: 10px 0; font-size: 1.5rem; color: #2c3e50; }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        /* å•Ÿå‹•æŒ‰éˆ• */
        .start-btn {
            background: #2980b9;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(41, 128, 185, 0.3);
            transition: transform 0.2s, background 0.2s;
            display: inline-block;
            width: 100%;
            max-width: 300px;
        }
        
        .start-btn:active { transform: scale(0.95); }
        .start-btn:disabled { background: #bdc3c7; cursor: not-allowed; box-shadow: none; }

        /* é€²åº¦æ¢æ¨£å¼å€å¡Š */
        .progress-container {
            display: none; /* é è¨­éš±è— */
            margin-top: 20px;
            text-align: left;
        }

        .progress-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .progress-bar-bg {
            width: 100%;
            height: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #3498db; /* è—è‰² */
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ä¸Šå‚³å€å¡Š */
        .upload-wrapper {
            opacity: 0.4;
            pointer-events: none;
            transition: all 0.5s;
            filter: grayscale(100%);
        }
        
        .upload-wrapper.enabled {
            opacity: 1;
            pointer-events: auto;
            filter: grayscale(0%);
        }

        .upload-section {
            border: 2px dashed #bdc3c7;
            padding: 30px 20px;
            border-radius: 15px;
            position: relative;
            background: #fafafa;
            margin-bottom: 20px;
        }

        input[type="file"] {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .preview-area {
            display: none;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        @media (min-width: 600px) { .preview-area { flex-direction: row; } }

        .image-box {
            flex: 1;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 12px;
        }

        img {
            max-width: 100%;
            border-radius: 8px;
            background-image: linear-gradient(45deg, #eee 25%, transparent 25%), 
                              linear-gradient(-45deg, #eee 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #eee 75%), 
                              linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 20px 20px;
        }

        .btn-download {
            display: inline-block;
            background-color: #27ae60;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>AI åœ–ç‰‡å»èƒŒ</h1>
        
        <div class="control-panel">
            <button id="startBtn" class="start-btn" onclick="startLoadingModel()">
                ğŸš€ é»æ“Šä¸‹è¼‰ AI æ¨¡å‹
            </button>
            
            <div id="progressContainer" class="progress-container">
                <div class="progress-label">
                    <span id="progressText">æ­£åœ¨é€£æ¥ä¼ºæœå™¨...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar-bg">
                    <div id="progressFill" class="progress-bar-fill"></div>
                </div>
            </div>
        </div>

        <div id="uploadWrapper" class="upload-wrapper">
            <div class="upload-section">
                <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“·</div>
                <p>æ¨¡å‹æº–å‚™å¥½å¾Œï¼Œé»æ­¤é¸æ“‡åœ–ç‰‡</p>
                <input type="file" id="fileInput" accept="image/*">
            </div>
        </div>

        <div class="preview-area" id="previewArea">
            <div class="image-box">
                <h3>åŸå§‹åœ–ç‰‡</h3>
                <img id="originalImg" src="" alt="Original">
            </div>
            <div class="image-box">
                <h3>å»èƒŒçµæœ</h3>
                <img id="resultImg" src="" alt="Result">
                <br>
                <a id="downloadLink" class="btn-download">ä¸‹è¼‰åœ–ç‰‡</a>
            </div>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('startBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressPercent = document.getElementById('progressPercent');
        
        const uploadWrapper = document.getElementById('uploadWrapper');
        const fileInput = document.getElementById('fileInput');
        const previewArea = document.getElementById('previewArea');
        const originalImg = document.getElementById('originalImg');
        const resultImg = document.getElementById('resultImg');
        const downloadLink = document.getElementById('downloadLink');

        const config = {
            publicPath: "https://cdn.jsdelivr.net/npm/@imgly/background-removal-data@1.5.5/dist/",
            progress: (key, current, total) => {
                // åªæœ‰åœ¨æ¨¡å‹æº–å‚™éšæ®µæ‰æ›´æ–°é€²åº¦æ¢
                if(isModelReady) return;

                if(total > 0) {
                    const percent = Math.round((current / total) * 100);
                    // æ›´æ–°è¦–è¦ºå¯¬åº¦
                    progressFill.style.width = percent + "%";
                    progressPercent.innerText = percent + "%";
                    progressText.innerText = `ä¸‹è¼‰è³‡æºä¸­: ${key}`;
                }
            }
        };

        let isModelReady = false;

        async function startLoadingModel() {
            startBtn.disabled = true;
            startBtn.style.display = 'none'; // éš±è—æŒ‰éˆ•
            progressContainer.style.display = 'block'; // é¡¯ç¤ºé€²åº¦æ¢

            try {
                // æš–æ©Ÿ
                const dummyImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";
                await imgly.removeBackground(dummyImage, config);
                
                // æˆåŠŸå¾Œ
                isModelReady = true;
                
                // é€²åº¦æ¢é¡¯ç¤ºå®Œæˆ
                progressFill.style.width = "100%";
                progressFill.style.backgroundColor = "#27ae60"; // è®Šç¶ è‰²
                progressPercent.innerText = "100%";
                progressText.innerText = "âœ… æ¨¡å‹è¼‰å…¥å®Œæˆï¼";
                
                // è§£é–ä¸Šå‚³
                uploadWrapper.classList.add('enabled');

            } catch (error) {
                console.error(error);
                startBtn.style.display = 'inline-block'; // é¡¯ç¤ºæŒ‰éˆ•è®“ä½¿ç”¨è€…é‡è©¦
                startBtn.disabled = false;
                startBtn.innerHTML = "âŒ å¤±æ•— - é»æ­¤é‡è©¦";
                
                progressFill.style.backgroundColor = "#c0392b"; // è®Šç´…è‰²
                progressText.innerText = "ä¸‹è¼‰ä¸­æ–·ï¼Œè«‹é‡è©¦";
            }
        }

        fileInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            originalImg.src = URL.createObjectURL(file);
            previewArea.style.display = 'flex';
            resultImg.src = ''; 
            downloadLink.style.display = 'none';
            
            // è®“ä¸Šæ–¹é€²åº¦æ¢é¡¯ç¤º "è™•ç†ä¸­" ç‹€æ…‹
            progressContainer.style.display = 'block';
            progressFill.style.width = "100%";
            progressFill.style.backgroundColor = "#e67e22"; // æ©˜è‰²ä»£è¡¨è™•ç†ä¸­
            progressText.innerText = "âš¡ æ­£åœ¨é€²è¡Œ AI å»èƒŒé‹ç®—...";
            progressPercent.innerText = "";

            try {
                const blob = await imgly.removeBackground(file, config);
                const url = URL.createObjectURL(blob);
                
                resultImg.src = url;
                downloadLink.href = url;
                downloadLink.download = 'removed-bg.png';
                downloadLink.style.display = 'inline-block';
                
                progressText.innerText = "âœ¨ è™•ç†å®Œæˆ";
                progressFill.style.backgroundColor = "#27ae60";

            } catch (error) {
                console.error(error);
                progressText.innerText = "âŒ è™•ç†å¤±æ•—";
                alert("éŒ¯èª¤ï¼š" + error.message);
            }
        });
    </script>
</body>
</html>
