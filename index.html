<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½åœ–ç‰‡å»èƒŒ (è‡ªå‹•é è¼‰ç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.5.5/dist/imgly-background-removal.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        h1 { color: #2c3e50; margin-bottom: 5px; }
        p.subtitle { color: #7f8c8d; margin-bottom: 20px; font-size: 0.9em; }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 900px;
            text-align: center;
        }

        /* ç‹€æ…‹åˆ—æ¨£å¼ */
        .status-bar {
            background: #fff3e0;
            color: #d35400;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .status-bar.ready {
            background: #e8f8f5;
            color: #27ae60;
        }

        .spinner {
            width: 16px; height: 16px;
            border: 2px solid rgba(0,0,0,0.1);
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .upload-section {
            border: 2px dashed #bdc3c7;
            padding: 40px;
            border-radius: 10px;
            cursor: not-allowed; /* é è¨­ç¦æ­¢é»æ“Šï¼Œç­‰æ¨¡å‹è¼‰å…¥å¥½ */
            position: relative;
            opacity: 0.6;
            transition: all 0.3s;
        }

        /* ç•¶æ¨¡å‹æº–å‚™å¥½æ™‚çš„æ¨£å¼ */
        .upload-section.active {
            border-color: #3498db;
            cursor: pointer;
            opacity: 1;
            background-color: #fbfbfb;
        }
        .upload-section.active:hover { background-color: #eef7fc; }
        
        input[type="file"] {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            cursor: pointer;
            pointer-events: none; /* é è¨­ç¦æ­¢ */
        }
        
        .upload-section.active input[type="file"] {
            pointer-events: auto; /* å•Ÿç”¨ */
        }

        .preview-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            display: none; /* é è¨­éš±è— */
        }

        .image-box {
            flex: 1;
            min-width: 280px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            background: #fafafa;
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            background-image: linear-gradient(45deg, #eee 25%, transparent 25%), 
                              linear-gradient(-45deg, #eee 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #eee 75%), 
                              linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .btn {
            background-color: #27ae60;
            color: white;
            padding: 10px 25px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>AI åœ–ç‰‡ä¸€éµå»èƒŒ</h1>
        <p class="subtitle">ç€è¦½å™¨ç«¯é‹ç®— | è‡ªå‹•é è¼‰æ¨¡å‹ | éš±ç§å®‰å…¨</p>

        <div id="statusBar" class="status-bar">
            <div class="spinner"></div>
            <span id="statusText">ç³»çµ±åˆå§‹åŒ–ä¸­ï¼Œæ­£åœ¨é è¼‰ AI æ¨¡å‹...</span>
        </div>

        <div class="upload-section" id="uploadSection">
            <p id="uploadText">â³ è«‹ç¨å€™ï¼Œæ­£åœ¨æº–å‚™ AI å¼•æ“...</p>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="preview-area" id="previewArea">
            <div class="image-box">
                <h3>åŸå§‹åœ–ç‰‡</h3>
                <img id="originalImg" src="" alt="Original">
            </div>
            <div class="image-box">
                <h3>å»èƒŒçµæœ</h3>
                <img id="resultImg" src="" alt="Result">
                <br>
                <a id="downloadLink" class="btn" style="display:none;">ä¸‹è¼‰ PNG</a>
            </div>
        </div>
    </div>

    <script>
        const statusBar = document.getElementById('statusBar');
        const statusText = document.getElementById('statusText');
        const uploadSection = document.getElementById('uploadSection');
        const uploadText = document.getElementById('uploadText');
        const fileInput = document.getElementById('fileInput');
        const previewArea = document.getElementById('previewArea');
        const originalImg = document.getElementById('originalImg');
        const resultImg = document.getElementById('resultImg');
        const downloadLink = document.getElementById('downloadLink');

        // å®šç¾©å…¨åŸŸ Configï¼Œç¢ºä¿ä½¿ç”¨ CDN
        const config = {
            publicPath: "https://staticimgly.com/@imgly/background-removal-data/1.5.5/dist/",
            progress: (key, current, total) => {
                // è¨ˆç®—ä¸¦é¡¯ç¤ºé€²åº¦
                const percent = total > 0 ? Math.round((current / total) * 100) : 0;
                // åªæœ‰åœ¨é‚„æ²’æº–å‚™å¥½æ™‚æ‰é¡¯ç¤ºä¸‹è¼‰é€²åº¦
                if (!isModelReady) {
                    statusText.innerText = `æ­£åœ¨ä¸‹è¼‰ AI çµ„ä»¶ (${key}): ${percent}%`;
                }
            }
        };

        let isModelReady = false;

        // --- è‡ªå‹•é è¼‰é‚è¼¯ (Warm-up) ---
        async function initModel() {
            try {
                // 1x1 åƒç´ çš„é€æ˜ PNG (æ¥µå°ï¼Œç”¨ä¾†è§¸ç™¼æ¨¡å‹ä¸‹è¼‰)
                const dummyImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";
                
                // åŸ·è¡Œä¸€æ¬¡ç©ºè·‘
                await imgly.removeBackground(dummyImage, config);
                
                // æˆåŠŸå¾Œæ›´æ–° UI
                isModelReady = true;
                statusBar.classList.add('ready');
                statusBar.innerHTML = 'âœ… AI æ¨¡å‹å·²æº–å‚™å°±ç·’ï¼Œè™•ç†é€Ÿåº¦å°‡å¤§å¹…æå‡ï¼';
                
                uploadSection.classList.add('active');
                uploadText.innerText = 'ğŸ“· é»æ“Šæ­¤è™•ä¸Šå‚³åœ–ç‰‡ (JPG, PNG)';
                
            } catch (error) {
                console.error("é è¼‰å¤±æ•—:", error);
                statusText.innerText = "âš ï¸ æ¨¡å‹é è¼‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚æ‚¨ä»å¯å˜—è©¦ä¸Šå‚³ã€‚";
                // å³ä½¿å¤±æ•—ä¹Ÿé–‹æ”¾ä¸Šå‚³ï¼Œè®“ä½¿ç”¨è€…æ‰‹å‹•è§¸ç™¼é‡è©¦
                uploadSection.classList.add('active');
            }
        }

        // é é¢è¼‰å…¥å¾Œç«‹å³åŸ·è¡Œé è¼‰
        window.onload = initModel;

        // --- è™•ç†ä½¿ç”¨è€…ä¸Šå‚³ ---
        fileInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // é¡¯ç¤ºé è¦½
            const originalUrl = URL.createObjectURL(file);
            originalImg.src = originalUrl;
            previewArea.style.display = 'flex';
            resultImg.src = ''; // æ¸…ç©ºèˆŠåœ–
            downloadLink.style.display = 'none';
            
            // æ›´æ–°ç‹€æ…‹
            statusBar.classList.remove('ready');
            statusBar.style.background = '#eef7fc';
            statusBar.style.color = '#2980b9';
            statusBar.innerHTML = '<div class="spinner"></div> æ­£åœ¨é€²è¡Œå»èƒŒé‹ç®—...';

            try {
                // æ­£å¼åŸ·è¡Œå»èƒŒ (å› ç‚ºæ¨¡å‹å·²è¼‰å…¥ï¼Œé€™æ¬¡æœƒå¾ˆå¿«)
                const blob = await imgly.removeBackground(file, config);
                
                const url = URL.createObjectURL(blob);
                resultImg.src = url;
                downloadLink.href = url;
                downloadLink.download = 'removed-bg.png';
                downloadLink.style.display = 'inline-block';
                
                statusBar.classList.add('ready');
                statusBar.innerHTML = 'âœ¨ è™•ç†å®Œæˆï¼';

            } catch (error) {
                console.error(error);
                statusBar.style.background = '#fadbd8';
                statusBar.style.color = '#c0392b';
                statusBar.innerText = 'âŒ è™•ç†å¤±æ•—ï¼Œè«‹é‡è©¦';
                alert("éŒ¯èª¤ï¼š" + error.message);
            }
        });
    </script>
</body>
</html>
